<div class="thread-controls-wrap">
  <!-- Moderated Thread Banner -->
  <div class="banner-container">
    <div class="banner warning" ng-if="PostsParentCtrl.thread.moderated">
      Moderated Thread &mdash; <em>Thread starter can moderate posts.</em>
    </div>
  </div>

  <!-- Page Title -->
  <div class="page-header-split">
    <!-- Show Title -->
    <div ng-if="!PostsParentCtrl.editThread" class="thread-title">
      <h1 ng-bind-html="::PostsParentCtrl.thread.title"></h1>
      <div class="badge locked" ng-if="PostsParentCtrl.thread.locked">
        <div class="" data-balloon="{{PostsParentCtrl.thread.locked ? 'Unlock Thread' : 'Lock Thread'}}"
          ng-if="PostsParentCtrl.canLock()">
          <a ng-href="#" id="lockThread" ng-class="{'clicked' : PostsParentCtrl.thread.locked }"
            ng-click="PostsParentCtrl.updateThreadLock()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <title>lock</title>
              <path
                d="M40,21H37.5V16.48a13.5,13.5,0,0,0-27,0V21H8a2,2,0,0,0-2,2V43a2,2,0,0,0,2,2H40a2,2,0,0,0,2-2V23A2,2,0,0,0,40,21ZM15.5,16.48a8.5,8.5,0,0,1,17,0V21h-17Z" />
            </svg>
            Locked
          </a>
        </div>
      </div>
      <!-- <i class="icon-epoch-lock" ng-if="PostsParentCtrl.thread.locked"></i> -->
      <i class="icon-epoch-verified" ng-if="PostsParentCtrl.thread.sticky"></i>
      <a data-balloon="Edit Thread Title" ng-href="#" class="do-edit" ng-if="PostsParentCtrl.canEditTitle()" ng-click="PostsParentCtrl.openEditThread()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
          <title>edit-pencil</title>
          <path d="M7.38,33.74h0L4,44l10.26-3.39h0L41.74,13.14,34.86,6.26Zm31-21.15.54.55L14.26,37.79l-.54-.54" />
          <path d="M45.48,6.89,41.11,2.52a1.78,1.78,0,0,0-2.5,0L36.11,5,43,11.89l2.5-2.5A1.76,1.76,0,0,0,45.48,6.89Z" />
        </svg>
      </a>
    </div>
    <!-- Edit Title -->
    <div ng-if="PostsParentCtrl.editThread">
      <form ng-submit="PostsParentCtrl.updateThreadTitle()">
        <input type="text" ng-model="PostsParentCtrl.thread.title" maxlength="255">
        <button type="submit" ng-disabled="PostsParentCtrl.thread.title.length === 0">Save</button>
        <button ng-click="PostsParentCtrl.closeEditThread()">Cancel</button>
      </form>
    </div>

    <!-- User Controls -->
    <div class="user-controls"
      ng-if="PostsParentCtrl.showUserControls() || PostsParentCtrl.showThreadControls() || PostsParentCtrl.canPost()">
      <div class="user-controls-base">
        <!-- Watch Thread -->
        <div ng-if="PostsParentCtrl.showUserControls()" data-balloon="Watch Thread">
          <a class="" ng-if="!PostsParentCtrl.thread.watched" ng-click="PostsParentCtrl.watchThread()" >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <title>watch</title>
              <path
                d="M24,9.75C11.3,9.75,0,24,0,24S11.3,38.25,24,38.25,48,24,48,24,36.7,9.75,24,9.75ZM24,36A12,12,0,1,1,36,24,12,12,0,0,1,24,36Z" />
              <path d="M24,15a8.89,8.89,0,0,0-3.06.57,3.93,3.93,0,1,1-5.37,5.37A8.89,8.89,0,0,0,15,24a9,9,0,1,0,9-9Z" />
            </svg>
          </a>
        </div>

        <!-- Add a Poll -->
        <div ng-if="PostsParentCtrl.showUserControls()" data-balloon="Add a Poll">
          <a class="" ng-if="PostsParentCtrl.canCreatePoll()"
            ng-click="PostsParentCtrl.addPoll = !PostsParentCtrl.addPoll">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <title>graph-bar</title>
              <polygon points="43.25 41.75 4.75 41.75 4.75 6.25 7.75 6.25 7.75 38.75 43.25 38.75 43.25 41.75" />
              <rect x="9.75" y="28.75" width="6" height="8" />
              <rect x="18.75" y="18.75" width="6" height="18" />
              <rect x="27.75" y="23.75" width="6" height="13" />
              <rect x="36.75" y="8.75" width="6" height="28" />
            </svg>
          </a>
        </div>

        <!-- Thread Lock -->
        <div class="control" data-balloon="{{PostsParentCtrl.thread.locked ? 'Unlock Thread' : 'Lock Thread'}}"
          ng-if="PostsParentCtrl.canLock()">
          <a ng-href="#" id="lockThread" ng-class="{'clicked' : PostsParentCtrl.thread.locked }"
            ng-click="PostsParentCtrl.updateThreadLock()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <title>lock</title>
              <path
                d="M40,21H37.5V16.48a13.5,13.5,0,0,0-27,0V21H8a2,2,0,0,0-2,2V43a2,2,0,0,0,2,2H40a2,2,0,0,0,2-2V23A2,2,0,0,0,40,21ZM15.5,16.48a8.5,8.5,0,0,1,17,0V21h-17Z" />
            </svg>
          </a>
        </div>

        <!-- Thread Sticky -->
        <div class="control" data-balloon="{{PostsParentCtrl.thread.sticky ? 'Unsticky Thread' : 'Sticky Thread'}}"
          ng-if="PostsParentCtrl.canSticky()">
          <a ng-href="#" id="stickyThread"
            ng-class="{'clicked' : PostsParentCtrl.thread.sticky }" ng-click="PostsParentCtrl.updateThreadSticky()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <title>verified</title>
              <path
                d="M41.79,3.83A19.77,19.77,0,0,1,23.67,2.15,19.77,19.77,0,0,1,5.55,3.83C-1.65,35.26,18.45,45,23.67,46.15,28.88,45,49,35.26,41.79,3.83Zm-20.52,29L12.37,24l2.12-2.12,6.78,6.78,13.1-13.1,2.12,2.12Z" />
            </svg>
          </a>
        </div>

        <!-- Purge Delete -->
        <div class="control" data-balloon="Purge Thread" ng-if="PostsParentCtrl.canPurge()">
          <a ng-href="#" id="purgeThread"
            ng-class="{'clicked' : PostsParentCtrl.showPurgeThreadModal }"
            ng-click="PostsParentCtrl.showPurgeThreadModal = true">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <title>delete-circle</title>
              <path
                d="M24,2A22,22,0,1,0,46,24,22,22,0,0,0,24,2ZM35.67,32.13l-3.54,3.54L24,27.54l-8.13,8.13-3.54-3.54L20.46,24l-8.13-8.13,3.54-3.54L24,20.46l8.13-8.13,3.54,3.54L27.54,24Z" />
            </svg>
          </a>
        </div>

        <!-- Move Thread -->
        <div class="control" data-balloon="Move Thread" ng-if="PostsParentCtrl.canMove()">
          <a ng-href="#" id="moveBoard"
            ng-class="{'clicked' : PostsParentCtrl.showMoveThreadModal }" ng-click="PostsParentCtrl.openMoveThreadModal()">
            <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
              <title>Move</title>
              <path d="m29.36 7.74a3 3 0 0 0 -4.25 4.26l9 9h-28.73a3 3 0 0 0 0 6h28.76l-9 9a3 3 0 0 0 4.25 4.24l16.23-16.24z" />
            </svg>
          </a>
        </div>
        <span ng-if="!PostsParentCtrl.showThreadControls()">&nbsp;</span>

        <!-- <div class="controls one-third-column">
              <a class="button right" ng-click="PostsParentCtrl.loadEditor()" ng-if="PostsParentCtrl.canPost()"><i class="fa fa-plus"></i>&nbsp;&nbsp;&nbsp;Post Reply</a>
            </div> -->

      </div>
    </div>
  </div>


  <!-- Polls -->
  <div class="fill-row" ng-if="PostsParentCtrl.addPoll">
    <poll-creator poll="PostsParentCtrl.poll" valid="PostsParentCtrl.pollValid"></poll-creator>
    <button class="fill-row" ng-disabled="!PostsParentCtrl.pollValid" ng-click="PostsParentCtrl.createPoll()">Create Poll</button>
  </div>
  <poll-viewer thread="PostsParentCtrl.thread" user-priority="PostsParentCtrl.posts[0].user.priority" reset="PostsParentCtrl.resetPoll"></poll-viewer>

  <!-- <pagination page-count="PostsParentCtrl.pageCount" page="PostsParentCtrl.page"></pagination> -->

</div>

<!-- Ads -->
<ad-viewer page="PostsParentCtrl.page"></ad-viewer>

<!-- Posts Listing -->
<div class="thread-data" ui-view="data"></div>

<!-- Sidebar -->
<div class="sidebar">
  <div class="sidebar-block">
    <div ng-if="PostsParentCtrl.canPost()" class="sidebar-actions">
      <!-- <a class="button" ng-click="PostsParentCtrl.loadEditor()" ng-if="PostsParentCtrl.canPost()">Post Reply</a> -->
      <div class="post-tools">

        <!-- Thread Lock -->
        <div class="control" data-balloon="{{PostsParentCtrl.thread.locked ? 'Unlock Thread' : 'Lock Thread'}}"
          ng-if="PostsParentCtrl.canLock()">
          <a ng-href="#" id="lockThread" ng-class="{'clicked' : PostsParentCtrl.thread.locked }"
            ng-click="PostsParentCtrl.updateThreadLock()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <title>lock</title>
              <path
                d="M40,21H37.5V16.48a13.5,13.5,0,0,0-27,0V21H8a2,2,0,0,0-2,2V43a2,2,0,0,0,2,2H40a2,2,0,0,0,2-2V23A2,2,0,0,0,40,21ZM15.5,16.48a8.5,8.5,0,0,1,17,0V21h-17Z" />
            </svg>
          </a>
        </div>

        <!-- Thread Sticky -->
        <div class="control" data-balloon="{{PostsParentCtrl.thread.sticky ? 'Unsticky Thread' : 'Sticky Thread'}}"
          ng-if="PostsParentCtrl.canSticky()">
          <a ng-href="#" id="stickyThread" ng-class="{'clicked' : PostsParentCtrl.thread.sticky }"
            ng-click="PostsParentCtrl.updateThreadSticky()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <title>verified</title>
              <path
                d="M41.79,3.83A19.77,19.77,0,0,1,23.67,2.15,19.77,19.77,0,0,1,5.55,3.83C-1.65,35.26,18.45,45,23.67,46.15,28.88,45,49,35.26,41.79,3.83Zm-20.52,29L12.37,24l2.12-2.12,6.78,6.78,13.1-13.1,2.12,2.12Z" />
            </svg>
          </a>
        </div>

        <!-- Purge Delete -->
        <div class="control" data-balloon="Purge Thread" ng-if="PostsParentCtrl.canPurge()">
          <a ng-href="#" id="purgeThread" ng-class="{'clicked' : PostsParentCtrl.showPurgeThreadModal }"
            ng-click="PostsParentCtrl.showPurgeThreadModal = true">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
              <title>delete-circle</title>
              <path
                d="M24,2A22,22,0,1,0,46,24,22,22,0,0,0,24,2ZM35.67,32.13l-3.54,3.54L24,27.54l-8.13,8.13-3.54-3.54L20.46,24l-8.13-8.13,3.54-3.54L24,20.46l8.13-8.13,3.54,3.54L27.54,24Z" />
            </svg>
          </a>
        </div>

        <!-- Move Thread -->
        <div class="control" data-balloon="Move Thread" ng-if="PostsParentCtrl.canMove()">
          <a ng-href="#" id="moveBoard" ng-class="{'clicked' : PostsParentCtrl.showMoveThreadModal }"
            ng-click="PostsParentCtrl.openMoveThreadModal()">
            <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
              <title>Move</title>
              <path d="m29.36 7.74a3 3 0 0 0 -4.25 4.26l9 9h-28.73a3 3 0 0 0 0 6h28.76l-9 9a3 3 0 0 0 4.25 4.24l16.23-16.24z" />
            </svg>
          </a>
        </div>

      </div>
    </div>
    <!-- <div class="controls">
      <pagination page-count="PostsParentCtrl.pageCount" page="PostsParentCtrl.page"></pagination>
    </div> -->
  </div>
</div>

<!-- Bottom Actions and Pagination -->
<div class="actions-bottom">
  <div class="actions-bottom-grid">
    <div id="pagination-bottom" class="pagination-bottom">
      <pagination page-count="PostsParentCtrl.pageCount" page="PostsParentCtrl.page"></pagination>
    </div>
    <div ng-if="PostsParentCtrl.canPost()" class="sidebar-actions">
      <a class="button small" ng-click="PostsParentCtrl.loadEditor()" ng-if="PostsParentCtrl.canPost()">Post Reply</a>
    </div>
  </div>
</div>

<!-- Bottom Actions and Pagination -->
<div class="actions-bottom">
  <div class="actions-bottom-grid">
    <div id="pagination-bottom" class="pagination-bottom">
      <pagination page-count="PostsParentCtrl.pageCount" page="PostsParentCtrl.page"></pagination>
    </div>
    <div ng-if="PostsParentCtrl.canPost()" class="sidebar-actions">
      <a class="button small" ng-click="PostsParentCtrl.loadEditor()" ng-if="PostsParentCtrl.canPost()">Post Reply</a>
    </div>
  </div>
</div>

<!-- spacer for editor -->
<!-- <div id="post-spacer"></div> -->

<!-- Editor -->
<div ng-if="PostsParentCtrl.canPost() && PostsParentCtrl.showEditor">

  <epochtalk-editor class="posts-editor"
    body-html="PostsParentCtrl.posting.post.body_html"
    body="PostsParentCtrl.posting.post.body"
    posting="PostsParentCtrl.posting"
    reset-switch="PostsParentCtrl.resetEditor"
    focus-switch="PostsParentCtrl.focusEditor"
    dirty="PostsParentCtrl.dirtyEditor"
    quote="PostsParentCtrl.quote"
    thread="PostsParentCtrl.thread"
    post-editor-mode="true"
    create-action="PostsParentCtrl.savePost"
    can-create="PostsParentCtrl.canSave"
    show-switch="PostsParentCtrl.showEditor">
  </epochtalk-editor>
</div>

<!-- Reporting Modal -->
<modal show="PostsParentCtrl.showReportModal" on-close="PostsParentCtrl.closeReportModal()">
  <form name="$parent.form" class="css-form">
    <h3 class="thin-underline" ng-if="PostsParentCtrl.reportControlAccess.reportPosts && PostsParentCtrl.reportControlAccess.reportUsers && !PostsParentCtrl.reportedPost.reported">Report User/Post</h3>
    <h3 class="thin-underline" ng-if="PostsParentCtrl.reportControlAccess.reportPosts && !PostsParentCtrl.reportControlAccess.reportUsers && !PostsParentCtrl.reportedPost.reported">Report Post</h3>
    <h3 class="thin-underline" ng-if="(!PostsParentCtrl.reportControlAccess.reportPosts && PostsParentCtrl.reportControlAccess.reportUsers) || (PostsParentCtrl.reportControlAccess.reportUsers && PostsParentCtrl.reportedPost.reported)">Report User</h3>
    <label ng-if="PostsParentCtrl.reportControlAccess.reportPosts && PostsParentCtrl.reportControlAccess.reportUsers && !PostsParentCtrl.reportedPost.reported">Which would you like to report?</label>
    <input ng-if="PostsParentCtrl.reportControlAccess.reportUsers && !PostsParentCtrl.reportedPost.reported_author" type="radio" name="reportPost" ng-model="PostsParentCtrl.offendingId" ng-value="PostsParentCtrl.reportedPost.user.id" id="reportUser" ng-disabled="PostsParentCtrl.reportSubmitted" required><label ng-if="PostsParentCtrl.reportControlAccess.reportUsers && !PostsParentCtrl.reportedPost.reported_author" for="reportUser">{{PostsParentCtrl.reportedPost.user.username}}</label>
    <input ng-if="PostsParentCtrl.reportControlAccess.reportPosts && !PostsParentCtrl.reportedPost.reported" type="radio" name="reportPost" ng-model="PostsParentCtrl.offendingId" ng-value="PostsParentCtrl.reportedPost.id" id="reportPost" ng-disabled="PostsParentCtrl.reportSubmitted" required><label ng-if="PostsParentCtrl.reportControlAccess.reportPosts && !PostsParentCtrl.reportedPost.reported" for="reportPost">{{PostsParentCtrl.reportedPost.user.username}}'s Post</label>
    <label>Reason for Report</label>
    <textarea modal-focus="{{PostsParentCtrl.showReportModal}}" name="reportReason" ng-model="PostsParentCtrl.reportReason" ng-disabled="PostsParentCtrl.reportSubmitted" placeholder="Give a brief reason for your report" rows="4" required maxlength="255"></textarea>
    <div class="clear">
      <button class="fill-row" ng-click="PostsParentCtrl.submitReport()"
        ng-disabled="$parent.form.$invalid || $parent.form.$errors || PostsParentCtrl.reportSubmitted" ng-bind="PostsParentCtrl.reportBtnLabel"></button>
    </div>
  </form>
</modal>

<!-- Purge Thread Modal -->
<modal show="PostsParentCtrl.showPurgeThreadModal" on-close="PostsParentCtrl.closePurgeThreadModal()">
  <form name="$parent.form" class="css-form" novalidate>
    <h3 class="thin-underline">Purge Thread</h3>
    <p>Are you sure you want to permanently delete this thread?</p>
    <!-- Save Button -->
    <div class="clear">
      <button class="fill-row" ng-click="PostsParentCtrl.purgeThread()">
        Purge Thread
      </button>
    </div>
  </form>
</modal>

<!-- Move Thread Modal -->
<modal show="PostsParentCtrl.showMoveThreadModal" on-close="PostsParentCtrl.closeMoveThreadModal()">
  <form name="$parent.form" class="css-form" novalidate>
    <h3 class="thin-underline">Move Thread</h3>
    <label>Select a board to move this thread to:</label>
    <div class="control-full-width">
      <select modal-focus="{{PostsParentCtrl.showMoveThreadModal}}" name="boards" id="moveThreadBoards" ng-model="PostsParentCtrl.moveBoard" ng-options="board.name group by board.parent_name for board in PostsParentCtrl.boards | orderBy:board.view_order"></select>
    </div>
    <!-- Save Button -->
    <div class="clear">
      <button class="fill-row" ng-click="PostsParentCtrl.moveThread()">
        Move Thread
      </button>
    </div>
  </form>
</modal>
