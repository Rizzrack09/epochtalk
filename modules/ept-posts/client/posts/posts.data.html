<div id="{{::post.id}}" ng-repeat="post in PostsCtrl.posts track by post.id" class="post-block" ng-class="{ 'highlighted': post.highlighted, 'hidden': post.hidden, 'deleted': post._deleted || post.user.ignored,  'editing': post.id === PostsParentCtrl.posting.post.id }">
  <!-- Delete Post View -->
  <div class="deleted" ng-if="post._deleted || post.user.ignored">
    Post
    <span ng-if="post._deleted">Hidden</span>
    <div class="right bold secondary-font-color-light" ng-if="post._deleted">#{{post.position}}</div>
    <span ng-if="post.user.ignored">Ignored</span>
    <small class="pointer" ng-if="post.user.ignored" ng-click="post.user.ignored = false">
      <strong>- Show Post</strong>
    </small>
  </div>

  <!-- Visible Post View -->
  <div ng-if="!post._deleted && !post.user.ignored" class="post-block-grid">
    <!-- Post Profile Section -->
    <div class="post-user">
      <a ui-sref="profile.posts({ username: post.user.username})">
        <div class="user-avatar">
          <span ng-if="post.user.online"ng-include="'static/templates/layout/svg/icon__online.html'" class="online green"></span>
          <!-- <span ng-if="!post.user.online" class="online green"><i class="fa fa-circle-o"></i></span> -->
          <img ng-style="" ng-src="{{::post.avatar || $webConfigs.default_avatar}}">
        </div>
        <div ng-if="post.user.activity > -1" title="{{ 'Activity: ' + post.user.activity }}" class="user-activity">Act: <span ng-bind="post.user.activity" class="user-activity-value"></span></div>
      </a>


      <div class="user-trust" ng-if="PostsParentCtrl.loggedIn()">
        <trust-score user="post.user" visible="PostsParentCtrl.thread.trust_visible"></trust-score>
      </div>

      <div class="user-rank">
        <rank-display ranks="PostsParentCtrl.pageData.metadata.ranks" maps="PostsParentCtrl.pageData.metadata.rank_metric_maps" user="post.user"></rank-display>

        <ignore-posts post="post"></ignore-posts>
      </div>
    </div>

    <!-- Post Body Section -->
    <div class="post-content">
      <!-- Post Title -->
      <div class="post-title">
        <div class="post-title-user">
          <a class="username" data-balloon="{{post.user.role_name || 'User'}}" ui-sref="profile.posts({ username: post.user.username})"  ng-bind="::post.user.username"></a>
          <div title="{{post.user.name}}" ng-if="post.user.name" class="display-name">
            <span ng-bind-html="::post.user.name | truncate:33"></span>
            <span class="hide-mobile">&nbsp;&mdash;&nbsp;</span>
          </div>
          <div title="{{post.user.role_name || 'user'}}" class="user-role" ng-bind="post.user.role_name || 'user'" ng-style="PostsCtrl.userRoleHighlight(post.user.highlight_color)"></div>
          <div class="timestamp">
            <span ng-bind="::post.created_at | humanDate"></span>
            <span ng-if="PostsCtrl.showEditDate(post)" ng-bind-html="'&nbsp;&mdash;&nbsp;Edited ' + (post.updated_at | humanDate)"></span>
          </div>
        </div>

        <ul class="post-action">
          <li ng-if="PostsCtrl.canPurge() && post.position !== 1">
            <a ng-href="#" class="post-action-icon" data-balloon="Purge" ng-click="PostsParentCtrl.openPurgeModal($index)" ng-include="'static/templates/layout/svg/trashcan.html'">
            </a>
          </li>
          <li ng-if="PostsCtrl.canDelete(post) && post.position !== 1 && !post.deleted">
            <a ng-href="#" class="post-action-icon" data-balloon="Hide" ng-click="PostsParentCtrl.openDeleteModal($index, post.locked)" ng-include="'static/templates/layout/svg/watch-hide.html'">
            </a>
          </li>
          <li ng-if="PostsCtrl.canDelete(post) && post.deleted">
            <a ng-href="#" class="post-action-icon selected" data-balloon="Unhide" ng-click="PostsParentCtrl.openUndeleteModal($index)" ng-include="'static/templates/layout/svg/watch-hide.html'">
            </a>
          </li>
          <li ng-if="PostsCtrl.canPostLock(post) && !post.locked">
            <a ng-href="#" class="post-action-icon" data-balloon="Lock Post" ng-click="PostsParentCtrl.lockPost(post)" ng-include="'static/templates/layout/svg/lock.html'">
            </a>
          </li>
          <li ng-if="PostsCtrl.canPostLock(post) && post.locked">
            <a ng-href="#" class="post-action-icon selected" data-balloon="Unlock Post" ng-click="PostsParentCtrl.unlockPost(post)" ng-include="'static/templates/layout/svg/lock.html'">
            </a>
          </li>
          <li ng-if="PostsParentCtrl.loggedIn() && post.user.id !== PostsCtrl.user.id && (PostsParentCtrl.reportControlAccess.reportPosts || PostsParentCtrl.reportControlAccess.reportUsers) && !PostsParentCtrl.bannedFromBoard" ng-hide="post.reported && post.reported_author">
            <a ng-href="#" class="post-action-icon" data-balloon="Report" ng-click="PostsCtrl.openReportModal(post)" ng-include="'static/templates/layout/svg/flag.html'">
            </a>
          </li>
          <li ng-if="PostsCtrl.canUpdate(post)">
            <a ng-href="#" class="post-action-icon" data-balloon="Edit" ng-click="PostsCtrl.loadEditor(post)" ng-include="'static/templates/layout/svg/edit-pencil.html'">
            </a>
          </li>
          <li ng-if="PostsCtrl.canPost()">
            <a ng-href="#" class="post-action-icon" data-balloon="Quote" ng-click="PostsCtrl.addQuote(post)" ng-include="'static/templates/layout/svg/quote.html'">
            </a>
          </li>
          <li>
            <a ng-href="{{::PostsCtrl.rootUrl}}?start={{::post.position}}#{{::post.id}}" ng-click="PostsCtrl.highlightPost()" class="post-action-icon" data-balloon="Permalink">
              <!-- <i class="icon-epoch-link"></i> -->
              <strong>#{{post.position}}</strong>
            </a>
          </li>
        </ul>
        <!-- <div class="clear"></div> -->
      </div>
      <!-- Post Body -->
      <div class="post-body" ng-class="{ 'rtl': post.right_to_left }" post-processing="post.body_html" style-fix="true"></div>
      <div ng-if="post.user.signature">
        <div class="post-sig-border"></div>
        <div class="post-signature" post-processing="post.user.signature" style-fix="true"></div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Post Modal -->
<modal show="PostsParentCtrl.showDeleteModal">
  <form name="$parent.form" class="css-form" novalidate>
    <h3 class="thin-underline">Hide Post</h3>
    <p>Are you sure you want to hide this post?</p>
    <label ng-if="PostsParentCtrl.canPostLockQuick(PostsParentCtrl.deletePostIndex) && PostsParentCtrl.deletePostLocked === false">
      <input type="checkbox" ng-model="PostsParentCtrl.deleteAndLock" modal-focus="{{PostsParentCtrl.showDeleteModal}}" />
      Lock Post (poster cannot hide/edit this post)?
    </label>
    <!-- Delete Button -->
    <div class="clear">
      <button class="fill-row" ng-click="PostsParentCtrl.deletePost()">
        Hide Post
      </button>
    </div>
  </form>
</modal>

<!-- Undelete Post Modal -->
<modal show="PostsParentCtrl.showUndeleteModal">
  <form name="$parent.form" class="css-form" novalidate>
    <h3 class="thin-underline">Unhide Post</h3>
    <p>Are you sure you want to unhide this post?</p>
    <!-- Undelete Button -->
    <div class="clear">
      <button class="fill-row" ng-click="PostsParentCtrl.undeletePost()">
        Unhide Post
      </button>
    </div>
  </form>
</modal>

<!-- Purge Post Modal -->
<modal show="PostsParentCtrl.showPurgeModal">
  <form name="$parent.form" class="css-form" novalidate>
    <h3 class="thin-underline">Purge Post</h3>
    <p>Are you sure you want to permanently delete this post?</p>
    <!-- Save Button -->
    <div class="clear">
      <button class="fill-row" ng-click="PostsParentCtrl.purgePost()">
        Purge Post
      </button>
    </div>
  </form>
</modal>
